# The version control workflow

**UNDER REVISION**

Today's topic is version control.

## Learning Objectives

From this lesson, students are expected to be able to:

- Demonstrate the above concepts using RStudio's git client with your participation GitHub repository.
- Be able to make a basic website out of your participation repository using GitHub Pages
- Know roughly what the above concepts are about

## Resources

Want to try a similar lesson to today's, but on your own? Follow along with [happygitwithr: rstudio-git-github](http://happygitwithr.com/rstudio-git-github.html), which is closely aligned with the goals of this lesson.

Want to learn more, above and beyond what's done in class? Take a look at these:

- Excellent [resource by GitHub](https://blog.github.com/2015-06-08-how-to-undo-almost-anything-with-git/) on how to "undo" almost anything (including "going back" to a previous state).

The GitHub documentation is perhaps the best place to learn about these outside of class:

- [GitHub Pages](https://pages.github.com/)
- [Forking](https://help.github.com/articles/fork-a-repo/)
    - [happygitwithr: fork](http://happygitwithr.com/fork.html) is also a good resource.
- [Pull Request](https://help.github.com/articles/about-pull-requests/)


[Branching on GitHub](https://help.github.com/articles/creating-and-deleting-branches-within-your-repository/)

RESOURCES FOR INSTALLING PDFLATEX

## Working locally with git


Concept: local vs. remote.

### Preliminary: configuring git (3 min)

You'll need to [config your git](http://happygitwithr.com/hello-git.html) using the command line.

Your RStudio will probably be able to "find" git. But if it can't, you'll encounter errors. See [happygitwithr: see-git](http://happygitwithr.com/rstudio-see-git.html) for help. 

__Optional__ (but recommended): After class, you might want to [cache](http://happygitwithr.com/credential-caching.html) your credentials so that you don't have to keep inserting your password.


### The typical workflow (8 min)

The majority of your interaction with version control will be this workflow. 

0. __Clone__ your repository if you don't have a local copy.

Once you have a local copy of the repository.

1. __Pull__ the remote repo.
2. Make changes to your files, __stage__ and __commit__ them.
3. __Push__ the changes (after perhaps pulling again).

Git treats the remote repository as the "official" version of the repository. This means that your local copy is a second class citizen -- the repository you have locally must be up-to-date with the remote repository before you are allowed to push your work. If there are commits on the remote repository that are not present locally, git will throw an error if you try to push your changes. 

Integrate version control as you do work!

- Workflow without version control: save your files spontaneously.
- Workflow with version control: save your files spontaneously, commit your changes after every "step" in your work, and push your changes [in case of fire](https://github.com/louim/in-case-of-fire). 

### The typical workflow: Activity (5 min)

Let's make a change to our repository from local.  

1. Cloning your participation repo.
    - In RStudio, File -> New Project -> Version Control -> Git.
    - You should see a `Git` tab in RStudio, upper-right corner window. If not, see [happygitwithr: see-git](http://happygitwithr.com/rstudio-see-git.html) for help.
    - Take a look at the files you just downloaded!
- By the way:   
    - What's an RStudio "project"?
    - We don't need to edit a file _with RStudio_ to use its git client!
    - File doesn't need to have anything to do with R, either.
- Staging and committing:
    1. Concept
    2. Modify your Rmd exploration from earlier (just add a new line).
    3. Stage and commit
- Push/Pull:
    1. Concept
    2. Try pushing!

### Git Clients (3 min)

We just saw that RStudio can "talk to" git. But there are other ways we can use git locally. 

### Merge conflicts (5 min)

If you change a file locally, and that same file (_and_ the same lines) get changed on the remote repository in a different way, you'll end up with a _merge conflict_ that you'll need to resolve. Remember that your local copy is a second class citizen compared to the remote version, so you'll have to resolve things locally before pushing to the remote. 

### Merge conflicts: Activity (5 min)

2. Edit line 1 of the README _on both branches_ to something different in both cases.
3. Try merging. You'll get a _merge conflict_ -- go ahead and resolve it, then merge. 

### Branching (5 min)

Can either create a branch locally, or on GitHub. 

To make a new branch on GitHub:

To switch to the new branch locally:

To make a new branch locally:

To push that branch to github:

- `git push` is actually `git push origin master`. 

### Branching: Activity (5 min)

Organizing the participation repo

1. Create a new branch locally, called "organizing":
    - Click the "Git" tab in the upper-right panel of RStudio
    - Within that window's option bar, click ![](./img/branch.png).
    - Name your branch and create!
2. Stage and commit the new files:
    - In the Git tab in RStudio, click the checkboxes for the files that you want to commit. This is called "staging".
3. Restructure your repository in a more sensible way, using folders.
4. Stage and commit the changes
4. Explore: 
    - switch between branches to see that the repo structure is different.
4. Push branch to GitHub.
4. Merge the branch to "master".

### Undoing Changes (5 min)

https://www.atlassian.com/git/tutorials/undoing-changes

### Undoing Changes: Activity (5 min)


### When all else fails (3 min)

If you're encountering problems with git locally, try:

- As always, google search. 
- [Burn it all down](http://happygitwithr.com/burn.html).
    - There's even an [xkcd comic](https://xkcd.com/1597/) on this.

The git documentation is not friendly. There's even a [parody](https://git-man-page-generator.lokaltog.net/) on it.


## GitHub for Collaboration, Part II

On Day 1, we saw GitHub Issues to facilitate collaboration. We'll look at other features useful for collaboration. 

- GitHub Pages
- Forking
- Tagging a Release

Alternatives to GitHub. Common ones are _bitbucket_ and _gitlab_. 

### Pull Requests (5 min)

(Show an example of discussion with pull requests)


### GitHub Pages (5 min)

### GitHub Pages: Activity (5 min)

Let's make your HTML files readble 

1. Set up a basic "GitHub pages" website with your participation repo:
    1. Go to "settings" on your repo.
    2. Scroll down to "GitHub Pages"
    3. Under "Source", click the "None" drop-down button, and select the branch you want to turn into a website.
2. Forking a repo: 
    1. Let's try forking the `Classroom` repo.
    2. We'll make a change, and will submit a pull request.

### Tagging a Release (5 min)

Tagging a release on GitHub is like putting a "star" next to a particular commit. It highlights a particular point in time of your repository that is noteworthy, typically after achieving some milestone. It's just easier than having to manually keep track of noteworthy points in your commit history.

Examples:

- After every year of finishing STAT 545A/547M, we tag a release so that we can easily navigate to earlier versions of the course.
- After sufficient development of an R package like [ggplot2](https://github.com/tidyverse/ggplot2/releases), a new release is tagged corresponding to the version of the package. 

### Tagging a Release: Activity (3 min)

Congratulations! We finished the first two weeks of STAT 545A, which focussed on _tools_. To mark this milestone, let's tag a release on our participation repositories.

1. 




